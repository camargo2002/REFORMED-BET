<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mines</title>
  <style>
    body {
      background: #0f172a;
      color: white;
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: start;
      padding-top: 60px;
      height: 100vh;
      margin: 0;
    }

    h1 {
      margin-bottom: 20px;
    }

    #board {
      display: grid;
      grid-template-columns: repeat(5, 60px);
      grid-gap: 10px;
      margin: 30px 0;
    }

    .tile {
      width: 60px;
      height: 60px;
      background: #334155;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.2s;
    }

    .tile.revealed {
      background: #475569;
    }

    .controls {
      display: flex;
      align-items: center;
      gap: 10px;
      background-color: #1e293b;
      padding: 15px 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 0 10px #00000050;
    }

    .controls input,
    .controls select,
    .controls button {
      font-size: 16px;
      padding: 6px 10px;
      border-radius: 5px;
      border: none;
      outline: none;
    }

    .controls button {
      background-color: #22c55e;
      color: #0f172a;
      font-weight: bold;
      cursor: pointer;
      transition: 0.2s;
    }

    .controls button:hover {
      background-color: #16a34a;
    }

    #popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #1e293b;
      color: #ffffff;
      padding: 20px 30px;
      border-radius: 12px;
      box-shadow: 0 0 12px rgba(0, 0, 0, 0.5);
      text-align: center;
      z-index: 9999;
      display: none;
    }

    #popup.show {
      display: block;
    }

    #popup-message {
      font-size: 18px;
      font-weight: bold;
      color: #22c55e;
      margin-bottom: 12px;
    }

    #close-popup {
      background-color: #334155;
      border: none;
      color: white;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: 0.2s;
    }

    #close-popup:hover {
      background-color: #475569;
    }

    .navbar {
      background-color: #22c55e;
      padding: 10px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100vw;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 1000;
    }

    .logo {
      font-size: 1.2rem;
      font-weight: bold;
      cursor: pointer;
    }

    .navbar-center {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      flex: 1;
      max-width: 700px;
    }

    .balance-box {
      background-color: #1e293b;
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 0.9rem;
      color: #cbd5e1;
      white-space: nowrap;
    }

    #credits {
      width: 100px;
      padding: 6px 10px;
      border: none;
      border-radius: 6px;
      font-size: 0.9rem;
      background-color: #1e293b;
      color: #ffffff;
    }

    .deposit-btn {
      background-color: #3b82f6;
      border: none;
      color: #fff;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }

    .navbar-icons {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .navbar-icons img {
      width: 24px;
      height: 24px;
      cursor: pointer;
      filter: brightness(100%);
      transition: filter 0.3s ease;
    }

    .navbar-icons img:hover {
      filter: brightness(85%);
    }

    .balance-icon {
      width: 18px;
      height: 18px;
    }
  </style>
</head>
<body>
    <header class="navbar">
        <div class="logo" onclick="window.location.href='../index.html'">
          REFORMED BET
        </div>
    
        <div class="navbar-center">
          <div class="balance-box">
            <span id="navbarBalance">0.00</span>
            <img src="https://img.icons8.com/ios-glyphs/20/ffffff/coin-in-hand.png" alt="Saldo" class="balance-icon" />
          </div>
          <input type="number" id="credits" value="500" />
          <button class="deposit-btn" id="depositBtn">Depositar</button>
        </div>
    
        <div class="navbar-icons">
          <img src="https://img.icons8.com/ios-glyphs/24/ffffff/appointment-reminders--v1.png" alt="Notificações" class="icon" />
          <img src="https://img.icons8.com/ios-glyphs/24/ffffff/user--v1.png" alt="Perfil" class="icon" />
        </div>
      </header>
    
      <h1>Mines Game</h1>
    
      <div class="controls">
        <label for="betAmount">Aposta:</label>
        <input type="number" id="betAmount" placeholder="10" value="10">
        <span>USD</span>
        <label for="mineCount">Mines:</label>
        <select id="mineCount"></select>
        <button id="startBtn">Apostar</button>
      </div>
    
      <div class="balance-text">
        <strong>Saldo:</strong> <span id="balance">0.00</span> USD
      </div>
    
      <div id="board"></div>
    
      <div id="popup" class="popup hidden">
        <div class="popup-content">
          <span id="popup-message"></span>
          <button id="close-popup">Fechar</button>
        </div>
      </div>
    
      <script>
        const boardSize = 5;
        const totalTiles = 25;
        let board = [];
        let balance = parseFloat(localStorage.getItem("sharedBalance")) || 1000;
        let minePositions = new Set();
        let diamondsFound = 0;
        let totalDiamonds = 0;
        let gameOver = false;
        let gameStarted = false;
        let currentBet = 0;
    
        const payoutTable = {
          1:{1:1.01,2:1.08,3:1.12,4:1.18,5:1.24,6:1.3,7:1.37,8:1.46,9:1.55,10:1.65,11:1.77,12:1.92,13:2.06,14:2.25,15:2.47,16:2.75,17:3.09,18:3.54,19:4.12,20:4.95,21:6.19,22:8.25,23:12.37,24:24.75},
          2:{1:1.08,2:1.17,3:1.29,4:1.41,5:1.56,6:1.74,7:1.94,8:2.18,9:2.47,10:2.81,11:3.21,12:3.69,13:4.27,14:5.01,15:5.94,16:7.10,17:8.57,18:10.61,19:13.24,20:16.74,21:21.46,22:29.70,23:49.50,24:99},
          3:{1:1.12,2:1.29,3:1.48,4:1.71,5:2.00,6:2.35,7:2.79,8:3.35,9:4.07,10:5.00,11:6.26,12:7.52,13:9.13,14:10.35,15:13.80,16:18.97,17:27.11,18:40.66,19:65.06,20:113.85,21:227.70,22:569.25,23:2277,24:0},
          4:{1:1.18,2:1.41,3:1.71,4:2.09,5:2.58,6:3.39,7:4.09,8:5.26,9:6.88,10:9.17,11:12.51,12:16.27,13:21.53,14:25.30,15:35.00,16:59.64,17:99.39,18:176.91,19:357.81,20:834.90,21:2504,22:12523,23:0,24:0},
          5:{1:1.24,2:1.56,3:2.00,4:2.58,5:3.39,6:4.52,7:6.14,8:8.35,9:11.34,10:15.26,11:20.52,12:27.12,13:35.38,14:44.07,15:59.64,16:99.39,17:178.91,18:357.81,19:834.90,20:2504,21:12523,22:0,23:0,24:0}
        };
    
        const navbarBalance = document.getElementById("navbarBalance");
        const creditsInput = document.getElementById("credits");
        const depositBtn = document.getElementById("depositBtn");
    
        function updateNavbarBalance() {
          if (navbarBalance) navbarBalance.textContent = "R$ " + balance.toFixed(2);
        }
    
        if (depositBtn) {
          depositBtn.addEventListener("click", () => {
            const value = parseFloat(creditsInput.value);
            if (!isNaN(value) && value > 0) {
              balance += value;
              updateBalance();
            }
          });
        }
    
        function showPopup(text) {
          const popup = document.getElementById('popup');
          const message = document.getElementById('popup-message');
          message.textContent = text;
          popup.style.display = 'block';
        }
    
        function hidePopup() {
          const popup = document.getElementById('popup');
          popup.style.display = 'none';
        }
    
        function startGame() {
          if (gameStarted) {
            cashOut();
            return;
          }
    
          const bet = parseFloat(document.getElementById('betAmount').value);
          const mineCountEl = document.getElementById('mineCount');
          const mineCount = parseInt(mineCountEl.value);
          const boardEl = document.getElementById('board');
    
          if (isNaN(bet) || bet <= 0 || bet > balance) {
            alert('Aposta inválida.');
            return;
          }
    
          document.getElementById('startBtn').textContent = 'Sacar';
    
          boardEl.innerHTML = '';
          board = [];
          minePositions.clear();
          diamondsFound = 0;
          totalDiamonds = totalTiles - mineCount;
          gameOver = false;
          gameStarted = true;
          currentBet = bet;
    
          while (minePositions.size < mineCount) {
            minePositions.add(Math.floor(Math.random() * totalTiles));
          }
    
          for (let i = 0; i < totalTiles; i++) {
            const tile = document.createElement('div');
            tile.classList.add('tile');
            tile.dataset.index = i;
            tile.onclick = () => revealTile(tile, mineCount);
            board.push({ el: tile, hasMine: minePositions.has(i), revealed: false });
            boardEl.appendChild(tile);
          }
    
          balance -= bet;
          updateBalance();
        }
    
        function revealTile(tile, mineCount) {
          if (gameOver || !gameStarted) return;
    
          const index = parseInt(tile.dataset.index);
          const cell = board[index];
          if (cell.revealed) return;
          cell.revealed = true;
          tile.classList.add('revealed');
    
          if (cell.hasMine) {
            tile.textContent = '💣';
            gameOver = true;
            gameStarted = false;
            revealAll();
            document.getElementById('startBtn').textContent = 'Apostar';
            showPopup('Você perdeu!');
          } else {
            tile.textContent = '💎';
            diamondsFound++;
          }
        }
    
        function cashOut() {
          const mineCount = parseInt(document.getElementById('mineCount').value);
    
          if (diamondsFound <= 0) {
            showPopup('Você precisa encontrar pelo menos 1 diamante antes de sacar.');
            return;
          }
    
          const multiplier = payoutTable[mineCount]?.[diamondsFound];
          if (typeof multiplier !== 'number' || isNaN(multiplier)) {
            showPopup('Multiplicador inválido. Não foi possível sacar.');
            return;
          }
    
          const win = currentBet * multiplier;
          balance += win;
    
          showPopup(`Você sacou ${win.toFixed(2)} USD com ${diamondsFound} diamantes!`);
          revealAll();
          gameStarted = false;
          document.getElementById('startBtn').textContent = 'Apostar';
          updateBalance();
        }
    
        function revealAll() {
          board.forEach((cell) => {
            if (!cell.revealed) {
              cell.el.classList.add('revealed');
              cell.el.textContent = cell.hasMine ? '💣' : '💎';
            }
            cell.revealed = true;
          });
        }
    
        function updateBalance() {
          document.getElementById('balance').textContent = balance.toFixed(2);
          localStorage.setItem("sharedBalance", balance.toFixed(2));
          updateNavbarBalance();
        }
    
        window.onload = () => {
          const mineSelect = document.getElementById('mineCount');
          if (mineSelect && mineSelect.options.length === 0) {
            for (let i = 1; i <= 24; i++) {
              const opt = document.createElement('option');
              opt.value = i;
              opt.textContent = i;
              mineSelect.appendChild(opt);
            }
          }
          document.getElementById('startBtn').addEventListener('click', startGame);
          document.getElementById('close-popup')?.addEventListener('click', hidePopup);
          updateBalance();
        };
      </script>
    </body>
    </html>
    